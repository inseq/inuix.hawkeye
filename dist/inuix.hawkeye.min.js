(()=>{"use strict";var e={664:(e,t,i)=>{i.d(t,{A:()=>u});var a=i(601),o=i.n(a),n=i(314),s=i.n(n),r=i(417),l=i.n(r),c=new URL(i(233),i.b),h=s()(o()),d=l()(c);h.push([e.id,`#publishingContainer{position:absolute;top:0;left:0;width:100%;z-index:15000}#publishingContainer img{all:unset}#hawkeyeToolbar,#hawkeyeToolbar *{all:unset;padding:0;margin:0;box-sizing:border-box}#hawkeyeToolbar{position:fixed;width:272px;top:0;left:calc(100vw - 312px);margin:12px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.1);background-color:rgba(240,240,240,.8);backdrop-filter:blur(10px);font-family:"Noto Sans KR";font-size:14px;line-height:1.4;overflow:hidden;z-index:20000}#hawkeyeToolbar div,#hawkeyeToolbar li,#hawkeyeToolbar p{display:block}#hawkeyeToolbar a{cursor:pointer}#hawkeyeToolbar a:hover{color:#000}#hawkeyeToolbar.uploaded .upload-before{display:none}#hawkeyeToolbar:not(.uploaded) .upload-after{display:none}#hawkeyeToolbar.collapsed{height:49px}#hawkeyeToolbar.collapsed .hawkeye-body{display:none}#hawkeyeToolbar.collapsed .hawkeye-foot .copyright{position:static}#hawkeyeToolbar.dragging{transition:none}#hawkeyeToolbar button{height:28px;padding:2px 6px;display:inline-flex;gap:4px;align-items:center;justify-content:center;background:#ddd;border-radius:8px;font-weight:500}#hawkeyeToolbar .hawkeye-head{height:50px;padding:12px 16px;border-bottom:1px solid rgba(0,0,0,.1);cursor:grab;user-select:none;display:flex;flex-direction:column}#hawkeyeToolbar .hawkeye-head .title-container{display:flex;justify-content:space-between;align-items:center}#hawkeyeToolbar:active{cursor:grabbing}#hawkeyeToolbar .toggle-button{width:24px;height:24px;cursor:pointer;opacity:.7;transition:opacity .2s}#hawkeyeToolbar .toggle-button:hover{opacity:1}#hawkeyeToolbar h1{display:flex;align-items:center;justify-content:center;gap:4px;line-height:1;font-size:14px;font-weight:bold}#hawkeyeToolbar h1::before{content:"";display:inline-block;width:33px;height:19px;background-image:url(${d});background-size:contain;background-repeat:no-repeat}#hawkeyeToolbar .hawkeye-body{display:flex;flex-direction:column}#hawkeyeToolbar .hawkeye-foot{border-top:1px solid rgba(0,0,0,.1);padding:6px 16px}#hawkeyeToolbar .hawkeye-foot ul{display:block;font-size:11px}#hawkeyeToolbar .hawkeye-foot .copyright{position:absolute;right:8px;bottom:5px;font-size:10px;line-height:1.2;color:#999;font-family:Arial,Helvetica,sans-serif}#hawkeyeToolbar .hawkeye-foot .copyright a{color:inherit;text-decoration:none}#hawkeyeToolbar .file-upload-area{margin:12px;border:2px dashed #666;padding:10px;border-radius:8px;font-size:13px;white-space:nowrap;overflow:hidden}#hawkeyeToolbar .upload-before{margin:0 16px 16px;display:flex;flex-direction:column;gap:8px;font-size:13px}#hawkeyeToolbar .upload-before a{text-decoration:underline}#hawkeyeToolbar .upload-after{display:flex;flex-direction:column}#hawkeyeToolbar .controller{display:flex;flex-direction:column;gap:8px;padding:12px 16px;border-top:1px solid rgba(0,0,0,.1);border-bottom:1px solid rgba(0,0,0,.1)}#hawkeyeToolbar .controller .opacity-slider{display:flex;align-items:center;gap:8px}#hawkeyeToolbar .controller .opacity-slider label{flex:0 0 auto}#hawkeyeToolbar .controller .opacity-slider #opacitySlider{flex:1 1 auto;width:100%;height:8px;background:#ddd;border-radius:5px;outline:none;opacity:.7;transition:opacity .3s}#hawkeyeToolbar .controller .opacity-slider #opacitySlider:hover{opacity:1}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-webkit-slider-runnable-track{width:100%;height:8px;cursor:pointer;background:#fff;border-radius:5px}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-moz-range-track{width:100%;height:8px;cursor:pointer;background:#ddd;border-radius:5px}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;margin-top:-4px;background:#333;border-radius:50%;cursor:pointer;box-shadow:0 0 2px rgba(0,0,0,.5);transition:background .3s}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-webkit-slider-thumb:hover{background:#555}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-moz-range-thumb{width:16px;height:16px;background:#333;border-radius:50%;cursor:pointer;box-shadow:0 0 2px rgba(0,0,0,.5);transition:background .3s}#hawkeyeToolbar .controller .opacity-slider #opacitySlider::-moz-range-thumb:hover{background:#555}#hawkeyeToolbar .controller .button-group{display:flex;justify-content:space-between}#hawkeyeToolbar .controller .buttons-container{display:flex;border-radius:8px;overflow:hidden}#hawkeyeToolbar .controller .buttons-container button{border-radius:0}#hawkeyeToolbar .controller .buttons-container button+button{border-left:1px solid hsla(0,0%,100%,.3)}#hawkeyeToolbar .controller .buttons-container .active{color:#fff;background:#888;box-shadow:inset 1px 1px 3px rgba(0,0,0,.5),inset -1px -1px 3px hsla(0,0%,100%,.3)}#hawkeyeToolbar .controller .buttons-container,#hawkeyeToolbar .controller .btn-invert,#hawkeyeToolbar .controller .btn-lock{box-shadow:1px 1px 3px rgba(0,0,0,.3),-1px -1px 3px hsla(0,0%,100%,.3)}#hawkeyeToolbar .reset-save-container{display:flex;gap:6px;padding:8px 16px}#hawkeyeToolbar .reset-save-container button{height:32px;flex:1 1 auto;background:#333;color:#fff}#hawkeyeToolbar #hawkeyeOverlayImage{position:absolute;top:0;left:0;max-width:unset;object-fit:contain;visibility:hidden;cursor:grab}#hawkeyeToolbar #stateContainer{display:flex;align-items:center;gap:4px}#hawkeyeToolbar #stateContainer input{width:56px;height:24px;padding:4px 4px 4px 6px;border-radius:4px;font-size:12px;background:#fff;border:0}`,""]);const u=h},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",a=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),a&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),a&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,a,o,n){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);a&&s[h[0]]||(void 0!==n&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=n),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),t.push(h))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function i(e){for(var i=-1,a=0;a<t.length;a++)if(t[a].identifier===e){i=a;break}return i}function a(e,a){for(var n={},s=[],r=0;r<e.length;r++){var l=e[r],c=a.base?l[0]+a.base:l[0],h=n[c]||0,d="".concat(c," ").concat(h);n[c]=h+1;var u=i(d),g={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(g);else{var p=o(g,a);a.byIndex=r,t.splice(r,0,{identifier:d,updater:p,references:1})}s.push(d)}return s}function o(e,t){var i=t.domAPI(t);i.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,o){var n=a(e=e||[],o=o||{});return function(e){e=e||[];for(var s=0;s<n.length;s++){var r=i(n[s]);t[r].references--}for(var l=a(e,o),c=0;c<n.length;c++){var h=i(n[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}n=l}}},659:e=>{var t={};e.exports=function(e,i){var a=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(i)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var a="";i.supports&&(a+="@supports (".concat(i.supports,") {")),i.media&&(a+="@media ".concat(i.media," {"));var o=void 0!==i.layer;o&&(a+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),a+=i.css,o&&(a+="}"),i.media&&(a+="}"),i.supports&&(a+="}");var n=i.sourceMap;n&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},233:e=>{e.exports='data:image/svg+xml;utf8,<svg width="33" height="19" viewBox="0 0 33 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.0359 0.875992C14.9008 0.890207 14.4815 0.939964 14.1119 0.982611C9.8542 1.46595 5.28378 3.90398 1.67294 7.62855C1.21803 8.09767 0.670722 8.70896 0.443267 8.98617L0.0310059 9.50505L0.443267 10.0168C1.0048 10.7205 2.34109 12.0923 3.16561 12.8031C6.58454 15.7672 10.2451 17.5157 14.1119 18.0417C14.979 18.1625 17.083 18.1625 17.9502 18.0417C21.8169 17.5157 25.4775 15.7672 28.8964 12.8031C29.7209 12.0923 31.0572 10.7205 31.6187 10.0168L32.031 9.50505L31.6187 8.98617C31.0572 8.28959 29.7209 6.91775 28.8964 6.20696C25.5414 3.2998 21.9306 1.54414 18.1989 1.00393C17.481 0.904425 15.4979 0.819128 15.0359 0.875992ZM17.2394 3.5628C18.4264 3.81158 19.4286 4.35889 20.3029 5.23317C21.4899 6.4273 22.0728 7.82046 22.0728 9.50505C22.0728 11.1896 21.4899 12.5828 20.3029 13.7769C19.4144 14.6583 18.4264 15.1914 17.2038 15.4544C16.4219 15.6179 15.0288 15.5468 14.254 15.298C12.1074 14.6157 10.5508 12.8884 10.0816 10.6779C9.98925 10.2301 9.98214 9.22784 10.0745 8.19008L10.0959 7.97684L9.46326 7.87733C8.95859 7.79914 8.82354 7.79914 8.7809 7.87022C8.70271 7.99105 8.56766 9.107 8.56766 9.58323C8.56766 10.031 8.73114 11.1683 8.85197 11.5521C9.21448 12.7036 9.87552 13.8622 10.6147 14.637C10.7569 14.7863 10.8422 14.9071 10.8138 14.9071C10.6787 14.9071 9.48458 14.3598 8.67428 13.9262C7.0892 13.0875 5.60364 12.0142 4.00435 10.5428C3.08032 9.70407 2.98081 9.57613 3.09453 9.36289C3.19404 9.17097 4.68671 7.82046 5.54678 7.1381C6.96837 6.00793 8.76668 4.93463 10.2736 4.30913L10.9488 4.02482L11.4179 4.53659L11.8871 5.05547L12.3064 4.73561C13.0741 4.13854 13.8702 3.76893 14.7871 3.56991C15.3558 3.44196 16.6636 3.44196 17.2394 3.5628ZM21.8808 4.34467C23.2882 4.92753 25.1221 6.03637 26.5152 7.1381C27.3753 7.82046 28.868 9.17097 28.9675 9.36289C29.0812 9.57613 28.9817 9.70407 28.0577 10.5428C26.4584 12.0142 24.9728 13.0875 23.3877 13.9262C22.5774 14.3598 21.3833 14.9071 21.2482 14.9071C21.2198 14.9071 21.3051 14.7863 21.4473 14.637C22.684 13.3504 23.4944 11.3105 23.4944 9.50505C23.4944 7.69963 22.684 5.65964 21.4473 4.366C21.3051 4.22384 21.2127 4.103 21.2482 4.103C21.2767 4.103 21.561 4.20962 21.8808 4.34467Z" fill="black"/><path d="M15.3771 5.52461C14.8297 5.62412 14.2469 5.86579 13.7422 6.20697C13.4721 6.39178 13.2589 6.54816 13.2589 6.56948C13.2589 6.5908 13.6925 7.09547 14.2185 7.69964C14.8724 8.44598 15.1425 8.79427 15.0572 8.79427C14.9861 8.79427 14.3322 8.69476 13.593 8.56681C12.74 8.42465 12.2353 8.36779 12.1927 8.41044C12.0576 8.54549 11.9652 9.56193 12.0434 10.0808C12.4486 12.6681 15.1283 14.2105 17.5379 13.2367C19.4855 12.4549 20.5161 10.2301 19.8409 8.23985C19.4357 7.0386 18.5046 6.10035 17.3317 5.70942C16.7205 5.50329 15.8959 5.4251 15.3771 5.52461Z" fill="black"/></svg>'},330:e=>{e.exports=JSON.parse('{"name":"inuix.hawkeye","version":"1.0.1","description":"이 플러그인은 웹 페이지 상에서 이미지 오버레이 기능을 제공하여\\r 퍼블리싱 결과물과 원본 디자인을 시각적으로 비교할 수 있도록 도와줍니다.","main":"dist/inuix.hawkeye.min.js","scripts":{"build":"webpack","start":"webpack serve --open"},"dependencies":{"moveable":"^0.53.0"},"devDependencies":{"@babel/core":"^7.26.0","@babel/preset-env":"^7.26.0","babel-loader":"^9.2.1","css-loader":"^6.0.0","sass":"^1.0.0","sass-loader":"^12.0.0","style-loader":"^3.0.0","terser-webpack-plugin":"^5.0.0","webpack":"^5.0.0","webpack-cli":"^4.0.0","webpack-dev-server":"^4.0.0"}}')}},t={};function i(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={id:a,exports:{}};return e[a](n,n.exports,i),n.exports}i.m=e,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.b=document.baseURI||self.location.href,i.nc=void 0;var a=i(72),o=i.n(a),n=i(825),s=i.n(n),r=i(659),l=i.n(r),c=i(56),h=i.n(c),d=i(540),u=i.n(d),g=i(113),p=i.n(g),y=i(664),m={};m.styleTagTransform=p(),m.setAttributes=h(),m.insert=l().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=u();o()(y.A,m);y.A&&y.A.locals&&y.A.locals;const b={enabled:!0,domains:{"pms.inseq.co.kr":!0,"dev.inseq.co.kr":!0,localhost:!0,"127.0.0.1":!0},ipRanges:["192.168."],pms:{enabled:!0,domain:"pms.inseq.co.kr",branches:{master:!1,develop:!0,"release/*":!0,"feature/*":!0,"hotfix/*":!0}},urlPatterns:["*"],storageKeys:{state:`hawkeye_${window.location.pathname}`,toolbar:"hawkeyeToolbarState"},ui:{containerId:"publishingContainer",toolbarId:"hawkeyeToolbar",overlayId:"hawkeyeOverlayImage"},defaultState:{opacity:.5,scale:1,position:{x:0,y:0},isLocked:!1,isInverted:!1,isHidden:!1}};class v{constructor(e){this.core=e,this.boundHandlers=new Map}initialize(){this.registerKeyboardEvents(),this.registerClipboardEvents(),this.registerWindowEvents(),this.registerInputEvents(),this.registerControlEvents()}registerKeyboardEvents(){const e=e=>{if("INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName)return e.altKey&&"v"===e.key.toLowerCase()?(e.preventDefault(),void this.core.toggleOverlayVisibility()):void(this.core.hasOverlayImage()&&!this.core.isOverlayLocked()&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&(e.preventDefault(),this.handleArrowKey(e.key)))};document.addEventListener("keydown",e),this.boundHandlers.set("keydown",e)}registerClipboardEvents(){const e=e=>{const t=(e.clipboardData||e.originalEvent.clipboardData).items;for(const e of t)if(-1!==e.type.indexOf("image")){const t=e.getAsFile();t&&this.core.displayOverlayImage(t)}};document.addEventListener("paste",e),this.boundHandlers.set("paste",e)}registerWindowEvents(){const e=()=>{const e=this.core.getToolbar();if(!e)return;const t=this.core.getToolbarState();t&&(t.position.left||t.position.top)&&(e.style.removeProperty("left"),e.style.removeProperty("top"),this.core.clearToolbarState())};window.addEventListener("resize",e),this.boundHandlers.set("resize",e)}registerInputEvents(){["xInput","yInput"].forEach((e=>{const t=document.getElementById(e);if(!t)return;const i=()=>{this.core.updateOverlayPosition()};t.addEventListener("input",i),this.boundHandlers.set(e,i)}));const e=document.getElementById("scaleInput");if(e){const t=()=>{this.core.updateOverlayScale()};e.addEventListener("input",t),this.boundHandlers.set("scaleInput",t)}const t=document.getElementById("opacitySlider");if(t){const e=e=>{this.core.setOverlayOpacity(e.target.value)};t.addEventListener("input",e),this.boundHandlers.set("opacitySlider",e)}}registerControlEvents(){const e=document.getElementById("overlayImageInput");if(e){const t=e=>{const t=e.target.files[0];t&&this.core.displayOverlayImage(t)};e.addEventListener("change",t),this.boundHandlers.set("fileInput",t)}this.registerControlButton("invertColorButton",(()=>this.core.invertOverlayColor())),this.registerControlButton("lockButton",(()=>this.core.toggleLockOverlay())),this.registerControlButton("toggleVisibilityButton",(()=>this.core.toggleOverlayVisibility())),this.registerControlButton("resetOverlayButton",(()=>this.core.resetOverlayState())),this.registerControlButton("saveImageButton",(()=>this.core.saveCurrentImage())),["top-left","top-right","bottom-left","bottom-right","center"].forEach((e=>{this.registerControlButton(e,(()=>this.core.setPosition(e)))}))}registerControlButton(e,t){const i=document.getElementById(e);i&&(i.addEventListener("click",t),this.boundHandlers.set(e,t))}handleArrowKey(e){const t=this.core.getOverlayImage();if(!t)return;let i=parseInt(t.style.top)||0,a=parseInt(t.style.left)||0;switch(e){case"ArrowUp":i-=1;break;case"ArrowDown":i+=1;break;case"ArrowLeft":a-=1;break;case"ArrowRight":a+=1}this.core.updateOverlayPosition(a,i)}destroy(){for(const[e,t]of this.boundHandlers.entries()){const i=document.getElementById(e)||document;i instanceof HTMLElement?(i.removeEventListener("click",t),i.removeEventListener("input",t),i.removeEventListener("change",t)):(document.removeEventListener(e,t),window.removeEventListener(e,t))}this.boundHandlers.clear()}}class f{constructor(e={}){this.config=e,this.db=null,this.saveTimeout=null,this.STORAGE_KEY=e.storageKeys?.state||`hawkeye_${window.location.pathname}`,this.isInitialized=!1}async initialize(){try{return this.isInitialized||(await this.initIndexedDB(),this.isInitialized=!0),!0}catch(e){return console.error("Failed to initialize StateManager:",e),!1}}async initIndexedDB(){return new Promise(((e,t)=>{try{const i=indexedDB.open("hawkeyeDB",1);i.onerror=()=>{console.error("IndexedDB open failed:",i.error),t(i.error)},i.onsuccess=()=>{this.db=i.result,this.db.onversionchange=()=>{this.db.close(),this.isInitialized=!1,console.warn("Database is outdated, please reload the page")},this.db.onerror=e=>{console.error("Database error:",e.target.error)},e()},i.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("states")||t.createObjectStore("states",{keyPath:"key"})}}catch(e){console.error("IndexedDB initialization failed:",e),t(e)}}))}async saveState(e){if(e)return this.saveTimeout&&clearTimeout(this.saveTimeout),new Promise(((t,i)=>{this.saveTimeout=setTimeout((async()=>{try{if(this.isInitialized&&this.db||await this.initialize(),!this.validateState(e))throw new Error("Invalid state structure");const a={key:this.STORAGE_KEY,...e,timestamp:Date.now()},o=this.db.transaction(["states"],"readwrite"),n=o.objectStore("states");o.oncomplete=()=>{t()},o.onerror=e=>{console.error("Transaction failed:",e.target.error);try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(a)),t()}catch(e){console.warn("Failed to backup to localStorage:",e),i(e)}};const s=n.put(a);s.onerror=()=>{console.error("Store put failed:",s.error),o.abort()}}catch(a){console.error("State save failed:",a);try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),t()}catch(e){console.warn("Failed to backup to localStorage:",e),i(e)}}}),300)}));console.warn("Invalid state provided to saveState")}async getState(){try{return this.isInitialized&&this.db||await this.initialize(),new Promise(((e,t)=>{try{const t=this.db.transaction(["states"],"readonly"),i=t.objectStore("states").get(this.STORAGE_KEY);i.onsuccess=()=>{const t=i.result;if(t)e(t);else try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const i=JSON.parse(t);this.saveState(i).catch(console.error),e(i)}else e(null)}catch(t){console.warn("Failed to read from localStorage:",t),e(null)}},i.onerror=()=>{console.error("Failed to read from IndexedDB:",i.error);try{const t=localStorage.getItem(this.STORAGE_KEY);e(t?JSON.parse(t):null)}catch(t){console.error("Failed to read from localStorage:",t),e(null)}}}catch(e){console.error("Transaction failed:",e),t(e)}}))}catch(e){return console.error("Failed to get state:",e),null}}async clearState(){try{return this.isInitialized&&this.db||await this.initialize(),new Promise(((e,t)=>{const i=this.db.transaction(["states"],"readwrite");i.oncomplete=()=>{try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.warn("Failed to remove from localStorage:",e)}e()},i.onerror=e=>{console.error("Clear state transaction failed:",e.target.error),t(e.target.error)};const a=i.objectStore("states").delete(this.STORAGE_KEY);a.onerror=()=>{console.error("Clear state request failed:",a.error),i.abort()}}))}catch(e){console.error("Failed to clear state:",e);try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){console.warn("Failed to remove from localStorage:",e)}throw e}}validateState(e){return["position","scale","opacity"].every((t=>t in e))}async saveToolbarState(e){if(e)try{localStorage.setItem(this.config.storageKeys.toolbar,JSON.stringify({...e,timestamp:Date.now()}))}catch(e){console.error("Failed to save toolbar state:",e)}}getToolbarState(){try{const e=localStorage.getItem(this.config.storageKeys.toolbar);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get toolbar state:",e),null}}destroy(){this.saveTimeout&&(clearTimeout(this.saveTimeout),this.saveTimeout=null),this.db&&(this.db.close(),this.db=null),this.isInitialized=!1}}const w=`\n  <div id="hawkeyeToolbar">\n    <div class="hawkeye-head">\n      <div class="title-container">\n        <h1 class="hawkeye-title">호크아이 - UI 대조 검토기</h1>\n        <button class="toggle-button">▼</button>\n      </div>\n    </div>\n    <div class="hawkeye-body">\n      <div class="file-upload-area">\n        <input type="file" id="overlayImageInput" accept="image/*" aria-label="오버레이 이미지 선택">\n      </div>\n      <div class="upload-before">\n        <p>이미지 파일을 업로드 하거나,<br> 클립보드 이미지를 Ctrl + V로 붙여넣으세요!</p>\n      </div>\n      <div class="upload-after">\n        <div class="controller">\n          <div class="opacity-slider">\n            <label for="opacitySlider">투명도</label>\n            <input type="range" id="opacitySlider" min="0" max="1" step="0.01" value="0.5" disabled>\n          </div>\n          <div class="button-group">\n            <div class="buttons-container">\n              <button id="toggleVisibilityButton" class="btn-toggle" title="이미지 on/off">🙉</button>\n              <button id="lockButton" class="btn-lock" title="잠금 및 해제">🔒</button>\n              <button id="invertColorButton" class="btn-invert" title="색상 반전">🌗</button>\n            </div>\n            <div class="buttons-container">\n              <button id="top-left" title="왼쪽상단">↖️</button>\n              <button id="top-right" title="오른쪽상단">↗️</button>\n              <button id="bottom-left" title="왼쪽하단">↙️</button>\n              <button id="bottom-right" title="오른쪽하단">↘️</button>\n              <button id="center" title="중앙">⏺️</button>\n            </div>\n          </div>\n          <div id="stateContainer">\n            <label for="xInput">x:</label>\n            <input type="number" id="xInput" value="0">\n            <label for="yInput">y:</label>\n            <input type="number" id="yInput" value="0">\n            <label for="scaleInput">scale:</label>\n            <input type="number" id="scaleInput" value="1.0" step="0.1">\n          </div>\n        </div>\n        <div class="reset-save-container">\n          <button id="resetOverlayButton">초기화</button>\n          <button id="saveImageButton">이미지 저장</button>\n        </div>\n      </div>\n    </div>\n    <div class="hawkeye-foot">\n      <ul>\n      <li><a href="http://pms.inseq.co.kr/inuix/hawkeye" target="_blank" title="새창">📖 호크아이 사용법</a></li>\n      <li><a href="http://pms.inseq.co.kr/inuix/hawkeye/issues" target="_blank" title="새창">🐞 오류제보 및 개선제안</a></li>\n      </ul>\n      <p class="copyright">\n        <span>Hawkeye v${i(330).version}</span>\n        <a href="https://inseq.co.kr" target="_blank" title="새창">©inseq</a>\n      </p>\n    </div>\n  </div>\n`;class k{constructor(e,t={}){this.stateManager=e,this.config=t,this.elements={container:null,toolbar:null,overlayImage:null,opacitySlider:null,toggleButton:null,lockButton:null,invertButton:null,xInput:null,yInput:null,scaleInput:null},this.isDragging=!1,this.dragOffset={x:0,y:0}}async initialize(){try{await this.initContainer();const e=document.createElement("img");return e.id=this.config.ui.overlayId,e.className="hawkeye-overlay-image",this.elements.container.appendChild(e),this.elements.overlayImage=e,await this.renderToolbar(),await new Promise((e=>setTimeout(e,0))),await this.initializeElements(),await this.attachEventListeners(),await this.restoreToolbarState(),!0}catch(e){return console.error("Failed to initialize UIManager:",e),!1}}initContainer(){return new Promise((e=>{let t=document.getElementById(this.config.ui.containerId);t||(t=document.createElement("div"),t.id=this.config.ui.containerId,t.className="publishing-container",document.body.appendChild(t)),this.elements.container=t,e()}))}renderToolbar(){return new Promise((e=>{const t=document.createElement("div");t.innerHTML=w,document.body.appendChild(t.firstElementChild),this.elements.toolbar=document.getElementById(this.config.ui.toolbarId),e()}))}initializeElements(){return new Promise(((e,t)=>{try{this.elements={...this.elements,toolbar:document.getElementById(this.config.ui.toolbarId),toggleButton:document.querySelector(".toggle-button"),opacitySlider:document.getElementById("opacitySlider"),toggleVisibilityButton:document.getElementById("toggleVisibilityButton"),lockButton:document.getElementById("lockButton"),invertButton:document.getElementById("invertColorButton"),xInput:document.getElementById("xInput"),yInput:document.getElementById("yInput"),scaleInput:document.getElementById("scaleInput")};const t=["container","overlayImage","toolbar","toggleButton",,"opacitySlider","toggleVisibilityButton","lockButton","invertButton","xInput","yInput","scaleInput"].filter((e=>!this.elements[e]));if(t.length>0)throw new Error(`Missing elements: ${t.join(", ")}`);e()}catch(e){t(e)}}))}attachEventListeners(){return new Promise((e=>{const t=this.elements.toolbar.querySelector(".hawkeye-head"),i=e=>{if(e.target===this.elements.toggleButton)return;this.isDragging=!0,this.elements.toolbar.classList.add("dragging");const t="mousedown"===e.type?e.clientX:e.touches[0].clientX,i="mousedown"===e.type?e.clientY:e.touches[0].clientY;this.dragOffset={x:t-this.elements.toolbar.offsetLeft,y:i-this.elements.toolbar.offsetTop}},a=e=>{if(!this.isDragging)return;e.preventDefault();const t="mousemove"===e.type?e.clientX:e.touches[0].clientX,i="mousemove"===e.type?e.clientY:e.touches[0].clientY;let a=t-this.dragOffset.x,o=i-this.dragOffset.y;const n=100,s=window.innerWidth-this.elements.toolbar.offsetWidth+n,r=window.innerHeight-this.elements.toolbar.offsetHeight+n;a=Math.max(-100,Math.min(a,s)),o=Math.max(-100,Math.min(o,r)),this.elements.toolbar.style.left=`${a}px`,this.elements.toolbar.style.top=`${o}px`,this.saveToolbarState()},o=()=>{this.isDragging=!1,this.elements.toolbar.classList.remove("dragging")};t.addEventListener("mousedown",i),document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),t.addEventListener("touchstart",i,{passive:!0}),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",o,{passive:!0}),this.elements.toggleButton.addEventListener("click",(()=>this.toggleToolbar())),this.elements.toggleVisibilityButton.addEventListener("click",(()=>{const e="none"!==this.elements.overlayImage.style.display;this.elements.overlayImage.style.display=e?"none":"block",this.updateVisibilityButton(!e),this.saveToolbarState()})),e()}))}toggleToolbar(){const e=this.elements.toolbar.classList.toggle("collapsed");this.elements.toggleButton.innerHTML=e?"▲":"▼",this.saveToolbarState()}async saveToolbarState(){const e={collapsed:this.elements.toolbar.classList.contains("collapsed"),position:{left:this.elements.toolbar.style.left,top:this.elements.toolbar.style.top},isHidden:"none"===this.elements.overlayImage.style.display};await this.stateManager.saveToolbarState(e)}async restoreToolbarState(){const e=await this.stateManager.getToolbarState();e&&(e.collapsed&&(this.elements.toolbar.classList.add("collapsed"),this.elements.toggleButton.innerHTML="▲"),e.position&&(this.elements.toolbar.style.left=e.position.left,this.elements.toolbar.style.top=e.position.top),void 0!==e.isHidden&&(this.elements.overlayImage.style.display=e.isHidden?"none":"block",this.updateVisibilityButton(e.isHidden)))}updateControls(e){e&&(e.hasImage?(document.querySelector(".upload-before").style.display="none",document.querySelector(".upload-after").style.display="flex"):(document.querySelector(".upload-before").style.display="flex",document.querySelector(".upload-after").style.display="none"),void 0!==e.opacity&&(this.elements.opacitySlider.value=e.opacity,this.elements.opacitySlider.disabled=!e.hasImage),e.position&&(this.elements.xInput.value=e.position.x,this.elements.yInput.value=e.position.y),e.scale&&(this.elements.scaleInput.value=e.scale),void 0!==e.isHidden&&this.updateVisibilityButton(e.isHidden),void 0!==e.isLocked&&this.elements.lockButton.classList.toggle("active",e.isLocked),void 0!==e.isInverted&&this.elements.invertButton.classList.toggle("active",e.isInverted))}resetControls(){this.elements.xInput.value=0,this.elements.yInput.value=0,this.elements.scaleInput.value=1,this.elements.opacitySlider.value=.5,this.elements.opacitySlider.disabled=!0,this.elements.lockButton.classList.remove("active"),this.elements.invertButton.classList.remove("active"),document.querySelector(".upload-before").style.display="flex",document.querySelector(".upload-after").style.display="none"}destroy(){this.elements.toolbar&&this.elements.toolbar.remove(),this.elements.overlayImage&&this.elements.overlayImage.remove(),this.elements={}}updatePositionInputs(e){e&&(this.elements.xInput&&(this.elements.xInput.value=Math.round(e.x)),this.elements.yInput&&(this.elements.yInput.value=Math.round(e.y)))}updateScaleInput(e){this.elements.scaleInput&&(this.elements.scaleInput.value=parseFloat(e).toFixed(2))}updateOpacitySlider(e){this.elements.opacitySlider&&(this.elements.opacitySlider.value=e,this.elements.opacitySlider.disabled=!1)}updateVisibilityButton(e){this.elements.toggleVisibilityButton&&(this.elements.toggleVisibilityButton.innerHTML=e?"🙈":"🙉",this.elements.toggleVisibilityButton.classList.toggle("active",e))}updateLockButton(e){this.elements.lockButton&&this.elements.lockButton.classList.toggle("active",e)}updateInvertButton(e){this.elements.invertButton&&this.elements.invertButton.classList.toggle("active",e)}}class x{constructor(e){this.config=e,this.currentDomain=window.location.hostname,this.currentPath=window.location.pathname}async checkVisibility(){try{if(!this.config.enabled)return console.info("[Hawkeye] 전역 설정에 의해 비활성화됨"),!1;if(this.isDevelopment())return!0;if(!this.checkDomain())return console.info(`[Hawkeye] ${this.currentDomain} 도메인에서 비활성화됨`),!1;if(!this.checkUrlPattern())return console.info(`[Hawkeye] URL 패턴 불일치: ${this.currentPath}`),!1;if(this.isPMSEnvironment()&&this.config.pms?.enabled){if(!await this.checkBranch())return console.info("[Hawkeye] 현재 브랜치에서 비활성화됨"),!1}return!0}catch(e){return console.error("[Hawkeye] 노출 여부 확인 중 오류:",e),!1}}isDevelopment(){return"localhost"===this.currentDomain||"127.0.0.1"===this.currentDomain||this.currentDomain.includes(".local")||"8080"===window.location.port}isPMSEnvironment(){return this.currentDomain===this.config.pms?.domain}checkDomain(){const{domains:e,ipRanges:t}=this.config;if(t&&t.length>0){if(t.some((e=>{const t=e.replace(/\./g,"\\.")+".*";return new RegExp(`^${t}`).test(this.currentDomain)})))return!0}if(!e||0===Object.keys(e).length)return!0;if(void 0!==e[this.currentDomain])return e[this.currentDomain];for(const[t,i]of Object.entries(e))if(this.currentDomain.endsWith(`.${t}`))return i;return!0}checkUrlPattern(){return!this.config.urlPatterns||0===this.config.urlPatterns.length||this.config.urlPatterns.some((e=>"*"===e||(e instanceof RegExp?e.test(this.currentPath):this.matchWildcard(this.currentPath,e))))}async checkBranch(){try{const e=this.extractBranchFromUrl();if(!e)return!0;const t=this.config.pms?.branches;if(!t)return!0;if(void 0!==t[e])return t[e];for(const[i,a]of Object.entries(t))if(i.includes("*")&&this.matchWildcard(e,i))return a;return!0}catch(e){return console.error("[Hawkeye] 브랜치 확인 중 오류:",e),!0}}extractBranchFromUrl(){try{const e=this.currentPath.match(/\/[^/]+\/[^/]+\/files\/([^/]+)/);return e?decodeURIComponent(e[1]):null}catch(e){return console.error("[Hawkeye] 브랜치명 추출 중 오류:",e),null}}matchWildcard(e,t){const i=t.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${i}$`).test(e)}}class I{static getBase64FromImage(e){try{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;return t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png")}catch(e){return console.error("Failed to convert image to Base64:",e),null}}static async loadImage(e){return new Promise(((t,i)=>{const a=new FileReader;a.onload=e=>{const a=new Image;a.onload=()=>t(a),a.onerror=i,a.src=e.target.result},a.onerror=i,a.readAsDataURL(e)}))}static calculateInitialScale(e,t){const i=e/t;return i<2?1:Number((1/Math.floor(i)).toFixed(2))}static createObjectURL(e){try{return URL.createObjectURL(e)}catch(e){return console.error("Failed to create object URL:",e),null}}static revokeObjectURL(e){e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}}class S{constructor(e,t,i={}){this.container=e,this.stateManager=t,this.config=i,this.image=null,this.moveableInstance=null,this.isRestoringState=!1,this.originalWidth=0,this.originalHeight=0,this.currentScale=1,this.state={position:{x:0,y:0},scale:1,opacity:.5,isLocked:!1,isInverted:!1,isHidden:!1}}async initialize(){return await this.createImageElement(),this}createImageElement(){return this.image&&this.destroy(),this.image=document.createElement("img"),this.image.id=this.config.ui.overlayId,this.image.className="hawkeye-overlay-image",this.container.insertBefore(this.image,this.container.firstChild),this.image.style.position="absolute",this.image.style.maxWidth="unset",this.image.style.objectFit="contain",this.image.style.cursor="grab",this.image.style.visibility="hidden",this.image.style.transformOrigin="top left",this.image}initializeMoveable(){this.moveableInstance&&this.moveableInstance.destroy(),this.image&&!this.state.isLocked&&(this.moveableInstance=new window.Moveable(this.container,{target:this.image,draggable:!0,scalable:!1,resizable:!0,keepRatio:!0,origin:!1,throttleResize:0}),this.moveableInstance.on("drag",(({target:e,left:t,top:i})=>{e.style.left=`${t}px`,e.style.top=`${i}px`,this.state.position={x:t,y:i},this.notifyPositionChange()})),this.moveableInstance.on("dragEnd",(()=>{this.saveState()})),this.moveableInstance.on("resize",(({target:e,width:t,height:i,drag:a})=>{e.style.width=`${t}px`,e.style.height=`${i}px`,e.style.left=`${a.left}px`,e.style.top=`${a.top}px`,this.currentScale=t/this.originalWidth,this.state.scale=this.currentScale,this.state.position={x:a.left,y:a.top},this.notifyScaleChange(),this.notifyPositionChange()})),this.moveableInstance.on("resizeEnd",(()=>{this.saveState()})))}async displayImage(e,t={}){try{return this.isRestoringState=t.isRestoringState||!1,this.isRestoringState||(await this.stateManager.clearState(),this.state={position:{x:0,y:0},scale:1,opacity:.5,isLocked:!1,isInverted:!1,isHidden:!1}),this.image.src&&I.revokeObjectURL(this.image.src),new Promise((t=>{this.image.onload=()=>{if(this.originalWidth=this.image.naturalWidth,this.originalHeight=this.image.naturalHeight,this.isRestoringState||(this.currentScale=this.calculateInitialScale(),this.state.scale=this.currentScale),this.image.style.width=this.originalWidth*this.currentScale+"px",this.image.style.height=this.originalHeight*this.currentScale+"px",this.image.style.visibility="visible",this.image.style.opacity=this.state.opacity,!this.isRestoringState){const e=window.scrollY||document.documentElement.scrollTop,t=window.scrollX||document.documentElement.scrollLeft;this.image.style.top=`${e}px`,this.image.style.left=`${t}px`,this.state.position={x:t,y:e}}this.initializeMoveable(),this.notifyPositionChange(),this.notifyScaleChange(),this.notifyOpacityChange(),t()},this.image.onerror=()=>{console.error(`Failed to load image: ${e.name}`),t()},this.image.src=I.createObjectURL(e)}))}catch(e){throw console.error("Error in displayImage:",e),e}}calculateInitialScale(){const e=window.outerWidth||window.innerWidth,t=this.originalWidth/e;return t<2?1:Number((1/Math.floor(t)).toFixed(2))}setOpacity(e){this.image&&(this.state.opacity=e,this.image.style.opacity=e,this.notifyOpacityChange(),this.saveState())}updatePosition(e,t){this.image&&(this.image.style.left=`${e}px`,this.image.style.top=`${t}px`,this.state.position={x:e,y:t},this.moveableInstance&&this.moveableInstance.updateRect(),this.notifyPositionChange(),this.saveState())}updateScale(e){!this.image||isNaN(e)||e<=0||(this.currentScale=e,this.image.style.width=this.originalWidth*e+"px",this.image.style.height=this.originalHeight*e+"px",this.state.scale=e,this.moveableInstance&&this.moveableInstance.updateRect(),this.notifyScaleChange(),this.saveState())}toggleVisibility(){if(this.image){if(this.state.isHidden=!this.state.isHidden,this.image.style.visibility=this.state.isHidden?"hidden":"visible",this.moveableInstance){document.querySelectorAll(".moveable-control-box, .moveable-line, .moveable-direction").forEach((e=>{e.style.visibility=this.state.isHidden?"hidden":"visible"}))}this.notifyVisibilityChange(),this.saveState()}}toggleInvert(){if(!this.image)return;this.state.isInverted=!this.state.isInverted;const e=this.image.style.filter;this.state.isInverted?this.image.style.filter=e?`${e} invert(1)`:"invert(1)":this.image.style.filter=e.replace("invert(1)","").trim(),this.notifyInvertChange(),this.saveState()}toggleLock(){this.image&&(this.state.isLocked=!this.state.isLocked,this.state.isLocked?(this.image.style.pointerEvents="none",this.image.style.userSelect="none",this.moveableInstance&&(this.moveableInstance.destroy(),this.moveableInstance=null)):(this.image.style.pointerEvents="auto",this.image.style.userSelect="auto",this.initializeMoveable()),this.notifyLockChange(),this.saveState())}notifyPositionChange(){this.config.onPositionChange&&this.config.onPositionChange(this.state.position)}notifyScaleChange(){this.config.onScaleChange&&this.config.onScaleChange(this.state.scale)}notifyOpacityChange(){this.config.onOpacityChange&&this.config.onOpacityChange(this.state.opacity)}notifyLockChange(){this.config.onLockChange&&this.config.onLockChange(this.state.isLocked)}notifyVisibilityChange(){this.config.onVisibilityChange&&this.config.onVisibilityChange(this.state.isHidden)}notifyInvertChange(){this.config.onInvertChange&&this.config.onInvertChange(this.state.isInverted)}async saveState(){if(!this.image)return;const e={...this.state,imageBase64:I.getBase64FromImage(this.image),originalWidth:this.originalWidth,originalHeight:this.originalHeight};await this.stateManager.saveState(e)}async resetState(){if(this.state={position:{x:0,y:0},scale:1,opacity:.5,isLocked:!1,isInverted:!1,isHidden:!1},this.image){this.image.style.opacity=this.state.opacity,this.image.style.filter="",this.image.style.visibility="visible",this.image.style.pointerEvents="auto",this.image.style.userSelect="auto",this.currentScale=this.calculateInitialScale(),this.state.scale=this.currentScale;const e=window.scrollY||document.documentElement.scrollTop,t=window.scrollX||document.documentElement.scrollLeft;this.image.style.width=this.originalWidth*this.currentScale+"px",this.image.style.height=this.originalHeight*this.currentScale+"px",this.image.style.top=`${e}px`,this.image.style.left=`${t}px`,this.state.position={x:t,y:e},this.moveableInstance&&(this.moveableInstance.destroy(),this.moveableInstance=null),this.initializeMoveable()}this.notifyPositionChange(),this.notifyScaleChange(),this.notifyOpacityChange(),this.notifyLockChange(),this.notifyVisibilityChange(),this.notifyInvertChange(),await this.saveState()}async restoreState(e){if(e&&e.imageBase64){this.isRestoringState=!0;try{const t=await fetch(e.imageBase64),i=await t.blob(),a=new File([i],"restored.png",{type:"image/png"});this.currentScale=parseFloat(e.scale)||1,await this.displayImage(a,{isRestoringState:!0}),Object.assign(this.state,e),this.updatePosition(e.position.x,e.position.y),this.setOpacity(e.opacity),e.isInverted&&this.toggleInvert(),e.isLocked&&this.toggleLock(),e.isHidden&&this.toggleVisibility(),this.isRestoringState=!1}catch(e){console.error("Failed to restore state:",e),this.isRestoringState=!1}}}destroy(){this.moveableInstance&&(this.moveableInstance.destroy(),this.moveableInstance=null),this.image&&(this.image.src&&I.revokeObjectURL(this.image.src),this.image.remove(),this.image=null),this.state={position:{x:0,y:0},scale:1,opacity:.5,isLocked:!1,isInverted:!1,isHidden:!1}}}class C{static validateConfig(e){const t=[];return["enabled","ui.containerId","ui.toolbarId","ui.overlayId"].forEach((i=>{void 0===i.split(".").reduce(((e,t)=>e?.[t]),e)&&t.push(`필수 설정 누락: ${i}`)})),"boolean"!=typeof e.enabled&&t.push("enabled는 boolean 타입이어야 합니다"),void 0!==e.pms?.enabled&&"boolean"!=typeof e.pms.enabled&&t.push("pms.enabled는 boolean 타입이어야 합니다"),e.pms?.domain&&"string"!=typeof e.pms.domain&&t.push("pms.domain은 문자열이어야 합니다"),e.domains&&"object"!=typeof e.domains&&t.push("domains는 객체 형식이어야 합니다"),{isValid:0===t.length,errors:t}}static validateImageFile(e){const t=[];if(!e)return t.push("No file provided"),{isValid:!1,errors:t};e.type.startsWith("image/")||t.push("File must be an image");return e.size>10485760&&t.push("File size exceeds 10MB limit"),{isValid:0===t.length,errors:t}}static validatePosition(e,t){return{x:"number"==typeof e?e:parseInt(e)||0,y:"number"==typeof t?t:parseInt(t)||0}}static validateScale(e){const t=parseFloat(e);return isNaN(t)||t<=0?1:t}static validateOpacity(e){const t=parseFloat(e);return isNaN(t)?.5:Math.max(0,Math.min(1,t))}}class T{static handle(e,t=""){return console.error(`[Hawkeye Error] ${t}:`,e),e instanceof TypeError?"타입 에러가 발생했습니다.":e instanceof ReferenceError?"참조 에러가 발생했습니다.":"오류가 발생했습니다."}static async wrapAsync(e,t=""){try{return await e()}catch(e){throw T.handle(e,t),e}}}class E{constructor(e={}){this.config={...b,...e},this.initialized=!1,this.managers={state:null,event:null,ui:null,visibility:null},this.overlay=null,this.handleResize=this.handleResize.bind(this),this.handlePaste=this.handlePaste.bind(this)}async initialize(){try{if(!this.config.enabled)return console.info("[Hawkeye] 전역 설정에 의해 비활성화됨"),!1;const{isValid:e,errors:t}=C.validateConfig(this.config);if(!e)throw new Error(`Invalid configuration: ${t.join(", ")}`);this.managers.visibility=new x(this.config);return await this.managers.visibility.checkVisibility()?(this.managers.state=new f(this.config),await this.managers.state.initialize(),this.managers.ui=new k(this.managers.state,this.config),await this.managers.ui.initialize(),this.overlay=new S(this.managers.ui.elements.container,this.managers.state,{...this.config,onPositionChange:e=>this.managers.ui.updatePositionInputs(e),onScaleChange:e=>this.managers.ui.updateScaleInput(e),onOpacityChange:e=>this.managers.ui.updateOpacitySlider(e),onLockChange:e=>this.managers.ui.updateLockButton(e),onVisibilityChange:e=>this.managers.ui.updateVisibilityButton(e),onInvertChange:e=>this.managers.ui.updateInvertButton(e)}),await this.overlay.initialize(),this.managers.event=new v(this),this.managers.event.initialize(),await this.restoreState(),this.initialized=!0,!0):(console.info("[Hawkeye] Visibility conditions not met. Tool will not be displayed."),!1)}catch(e){return T.handle(e,"Core initialization failed"),!1}}displayOverlayImage(e){try{const t=C.validateImageFile(e);if(!t.isValid)throw new Error(t.errors.join(", "));this.overlay.displayImage(e),this.managers.ui.updateControls({hasImage:!0})}catch(e){T.handle(e,"Failed to display overlay image")}}setOverlayOpacity(e){const t=C.validateOpacity(e);this.overlay.setOpacity(t)}updateOverlayPosition(e=null,t=null){const i={x:null!==e?e:parseInt(this.managers.ui.elements.xInput.value)||0,y:null!==t?t:parseInt(this.managers.ui.elements.yInput.value)||0},a=C.validatePosition(i.x,i.y);this.overlay.updatePosition(a.x,a.y)}updateOverlayScale(){const e=C.validateScale(this.managers.ui.elements.scaleInput.value);this.overlay.updateScale(e)}toggleOverlayVisibility(){this.hasOverlayImage()&&this.overlay.toggleVisibility()}toggleLockOverlay(){this.hasOverlayImage()&&this.overlay.toggleLock()}invertOverlayColor(){this.hasOverlayImage()&&this.overlay.toggleInvert()}setPosition(e){if(!this.hasOverlayImage())return;const t=this.overlay.image,i=window.innerWidth,a=window.innerHeight,o=window.scrollX||document.documentElement.scrollLeft,n=window.scrollY||document.documentElement.scrollTop,s=parseFloat(t.style.width),r=parseFloat(t.style.height);let l,c;switch(e){case"top-left":l=o,c=n;break;case"top-right":l=o+i-s,c=n;break;case"bottom-left":l=o,c=n+a-r;break;case"bottom-right":l=o+i-s,c=n+a-r;break;case"center":l=o+(i-s)/2,c=n+(a-r)/2;break;default:return}this.updateOverlayPosition(l,c)}async saveState(){this.hasOverlayImage()&&await this.overlay.saveState()}async restoreState(){try{const e=await this.managers.state.getState();e&&(await this.overlay.restoreState(e),this.managers.ui.updateControls({hasImage:!0,opacity:e.opacity,position:e.position,scale:e.scale,isLocked:e.isLocked,isInverted:e.isInverted,isHidden:e.isHidden}))}catch(e){T.handle(e,"Failed to restore state")}}async resetOverlayState(){try{await this.managers.state.clearState(),this.overlay.destroy(),await this.overlay.initialize(),this.managers.ui.resetControls()}catch(e){T.handle(e,"Failed to reset state")}}hasOverlayImage(){return this.overlay&&null!==this.overlay.image}isOverlayLocked(){return!!this.overlay&&this.overlay.state.isLocked}getOverlayImage(){return this.overlay?this.overlay.image:null}getToolbarState(){return this.managers.state.getToolbarState()}saveToolbarState(e){return this.managers.state.saveToolbarState(e)}clearToolbarState(){this.managers.state&&localStorage.removeItem(this.config.storageKeys.toolbar)}getToolbar(){return this.managers.ui?this.managers.ui.elements.toolbar:null}handleResize(){this.hasOverlayImage()&&this.overlay.updateScale(this.overlay.currentScale)}handlePaste(e){const t=(e.clipboardData||e.originalEvent.clipboardData).items;for(const e of t)if(-1!==e.type.indexOf("image")){const t=e.getAsFile();t&&this.displayOverlayImage(t)}}async saveCurrentImage(){this.hasOverlayImage()&&alert("기능 준비중입니다.")}destroy(){Object.values(this.managers).forEach((e=>{e&&"function"==typeof e.destroy&&e.destroy()})),this.overlay&&this.overlay.destroy(),this.initialized=!1}}class L{static instance=null;static hasManualInit=!1;constructor(e={}){console.log("[Hawkeye] Constructor config:",e),L.instance&&(console.log("[Hawkeye] Destroying existing instance"),L.instance.destroy());const t=(e,i)=>{const a={...e};for(const o in i)i[o]instanceof Object&&!Array.isArray(i[o])?a[o]=t(e[o]||{},i[o]):a[o]=i[o];return a},i=t(b,e);this.core=new E(i),this.config=i,L.instance=this}async initialize(){try{if(console.log("[Hawkeye] Final merged config:",this.config),console.log("[Hawkeye] Current branch:",this.managers?.visibility?.extractBranchFromUrl()),!1===this.config.enabled)return console.log("[Hawkeye] Config disabled, destroying"),void this.destroy();await this.core.initialize()}catch(e){console.error("[Hawkeye] Init failed:",e)}}destroy(){this.core&&this.core.destroy()}static initialize(e={}){console.log("[Hawkeye] Manual initialize:",e),L.hasManualInit=!0;return new L(e).initialize()}}window.HawkeyeOverlayTool=L,L.hasManualInit||("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{L.hasManualInit||L.initialize()})):L.initialize())})();